<!DOCTYPE html>
<html lang="en">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script src="{{url_for('static', filename='javascript/button_funcs.js')}}"></script>
<script src="{{url_for('static', filename='javascript/shop.js')}}"></script>
<script src="{{url_for('static', filename='javascript/shipper_demo.js')}}"></script>

{% if name == "user" %}
    <script src="{{url_for('static', filename='javascript/user_demo.js')}}"></script>
{% endif %}
{% if name == "vendor" %}
    <script src="{{url_for('static', filename='javascript/vendor_demo.js')}}"></script>
{% endif %}
{% if name == "bank" %}
    <script src="{{url_for('static', filename='javascript/bank_demo.js')}}"></script>
{% endif %}
{% if name == "bank" %}
<script src="{{url_for('static', filename='javascript/shipper_demo.js')}}"></script>
{% endif %}

<body>
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">
                    {{ name }}
                </a>
            </div>
            <ul class="nav navbar-nav">
                <li><a href="/home">Home</a></li>
                <li><a href="connections">Connections</a></li>
                <li><a href="credentials">Credentials</a></li>
                <li><a href="proofs">Proofs</a></li>
                <li class="active"><a href="shop">Shop</a></li>
            </ul>
        </div>
    </nav>

  <div class="jumbotron text-center">
    {% if name %}
    <h1> {{ name }} Shop Demo </h1>
    {% else %}
    <h1> Sorry, no agent detected </h1>
    {% endif %}
    {% if did %}
    <h4>Registered public DID: {{ did }}</h4>
    {% endif %}
  </div>


<div class="container">
<div class="row">
    <div class="col-md-12">
        <h3 id="current_connection"><b>Current Connection: </b></h3>
        <h3 id="t_stage"><b>Current Transaction Stage: </b> </h3>
        <div id="connection_stuff">
            <h3>
                <u>Available Actions</u>
            </h3>
            <div class="btn-group-vertical" id="actions">
                {% if name != "user" %}
                <Button id = "inv_but" type="button" onclick="createInvite()" value="invButton">Create Invite</Button>
                {% endif %}
                <Button id = "status" type="button" onclick="getStatus()" value="statusButton">Get Server Status</Button>
            </div>
        </div>
        <div id = "inputstuff">
            <h3>
                Paste invitation JSON:
            </h3>
            <form action="/connections/receive_invite" id="invForm"  name=inviteForm method="post" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="invite_area">Paste Invite JSON</label>
                    <input class="form-control input-lg" id="invite_area" name="invite">
                </div>
                <button class="btn btn-default" type="submit" value="submit">Submit</button>
            </form>
            <div id = "demo">
            </div>
        </div>
    </div>
</div>
</div>


<!--div class="container">
      <div class="col-sm-6" id="second">
          <h2>Current Transaction Stage<br> </h2>
          <h3 id="t_stage">Current Transaction Stage<br> </h3>
      </div>
      <div class="col-sm-6" id="">
          <h3><u>Demo Actions</u></h3>
          <div class="btn-group-vertical" id="actions"></div>
      </div>
  </div-->
<!--
<script>
    function getUserActions(stage) {
        if (stage === "start") {
            $('#t_stage').append("Start: Make Purchase Request")
            $('#actions').append('<button type="button" onclick = "requestPurchase()">Purchase Item</button>')
        }

        else if (stage === "agreement_proposed") {
            $('#t_stage').append('Requested purchase: awaiting response')
        }

        else if (stage === "agreement_received") {
            $('#t_stage').append('Purchase approved, next step: Payment')
            $('#actions').append ('<button type="button" onclick = "proposeProofOfPaymentAgreement()">Make Payment</button>')
        }

        else if (stage === "payment_agreement_proven") {
            $('#t_stage').append('Payment in process; awaiting bank response')
        }

        else if (stage === "payment_credential_received") {
            $('#t_stage').append('Payment made.<br>Next step: proving payment to vendor')
            $('#actions').append('<button type="button" onclick = "proposeProofOfPayment()">Prove Payment to Vendor</button>')
        }

        else if (stage === "payment_credential_proven") {
            $('#t_stage').append('Received package number.<br>Awaiting proof of receipt')
        }

        else if (stage === "package_credential_received") {
            $('#t_stage').append('Received package credential. <br> Awaiting proof of receipt')
        }

        else if (stage === "package_receipt_validated") {
            $('#t_stage').append('Proven dispatch.<br> Next stage: prove ownership to shipper')
            $('#actions').append('<button type="button" onclick = "proposeProofOfOwnership()">Prove Package Ownership</button>')
        }

        else if (stage === "completed") {
            $('#t_stage').append('Transaction completed')
        }
    }
</script>
<script>
    function getVendorActions(stage) {
    if (stage === "start") {
        $('#t_stage').append("Start: awaiting purchase request")
    }

    else if (stage === "purchase_requested") {
        $('#t_stage').append('Requested purchase: automatically agreeing...')
    }

    else if (stage === "purchase_approved") {
        $('#t_stage').append('Purchase approved, awaiting proof of payment')
    }

    else if (stage === "payment_proven") {
        $('#t_stage').append('Payment proven. <br> Packaging goods...')
        $('#actions').append('<button type="button" onclick = "issueCredential()">Issue Package Credential</button>')
    }

    else if (stage === "package_shipped") {
    $('#t_stage').append('Package shipped. Awaiting confirmatoin of receipt by shipping service')
    }

    else if (stage === "receipt_confirmed") {
        $('#t_stage').append('Shipper has received package. <br> Next stage: prove to user that package at shipping service')
        $('#actions').append('<button type="button" onclick = "proposeProofOfDispatch()">Prove Package Status to User</button>')
    }

    else if (stage === "completed") {
        $('#t_stage').append('Vendors role in the transaction has been completed')
    }
    }
</script>
<script>
    function getBankActions(stage) {
    if (stage === "start") {
        $('#t_stage').append("Start: awaiting proof of payment agreement")
    }

    else if (stage === "purchase_requested") {
        $('#t_stage').append('Agreement validated. <br> Next stage: issue payment credential')
        $('#actions').append('<button type="button" onclick = "issueCredential()">Issue Package Credential</button>')
    }
    }
</script>
    <script>
    function getShipperActions(stage) {
    if (stage === "start") {
        $('#t_stage').append("Start: awaiting packages...")
        $('#actions').append('<button type="button" onclick = "issueCredential()">Send Receipt Credential</button>')
    }

    else if (stage === "receipt_issued") {
        $('#t_stage').append('Crednetial issued: awaiting proof of ownership of package')
    }
    else if (stage === "completed") {
        $('#t_stage').append('Transaction completed! Shipping...')
    }

    }
</script>
<script>
    function get(stage) {
    if (stage === "start") {
        $('#t_stage').append("Start: awaiting proof of payment agreement")
    }

    else if (stage === "purchase_requested") {
        $('#t_stage').append('Agreement validated. <br> Next stage: issue payment credential')
        $('#actions').append('<button type="button" onclick = "issueCredential()">Issue Package Credential</button>')
    }
    }
</script>
-->
<script>
$(document).ready(function() {
    var name = '{{ name }}'
    var stage = '{{ stage }}'
    if (name === "user") {
        console.log("user func, ".concat(name, " ", stage))
        getUserActions(stage)
    }
    else if (name === "vendor") {
        console.log("vendor func, ".concat(name, " ", stage))
        getVendorActions(stage)
    }
    else if (name === "bank") {
        console.log("bank func, ".concat(name, " ", stage))
        getBankActions(stage)
    }else if (name === "shipper") {
        console.log("shipper func, ".concat(name, " ", stage))
        getShipperActions(stage)
    }
})
</script>
</body>
</html>
